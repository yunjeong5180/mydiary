<!DOCTYPE html>
<html lang="ko"> <!-- ë¬¸ì„œì˜ ì–¸ì–´ ì„¤ì •: í•œêµ­ì–´ -->
<head>
  <meta charset="UTF-8"> <!-- í•œê¸€ ê¹¨ì§ ë°©ì§€ë¥¼ ìœ„í•œ ë¬¸ì ì¸ì½”ë”© -->
  <title>ğŸ“‹ ì¼ê¸° ëª©ë¡</title> <!-- ë¸Œë¼ìš°ì € íƒ­ ì œëª© -->

  <!-- CSS ìŠ¤íƒ€ì¼ ì—°ê²° -->
  <link rel="stylesheet" href="/style.css">

  <!-- Google Fontsì—ì„œ ë¶€ë“œëŸ¬ìš´ í•œê¸€ í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
</head>

<body>

<!-- âœ… ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="nav-bar">
  <h1 class="nav-title">ğŸ“˜ ë‚˜ì˜ ì¼ê¸°ì¥</h1> <!-- ì™¼ìª½ ì œëª© -->
  <div class="nav-menu"> <!-- ì˜¤ë¥¸ìª½ ë©”ë‰´ ë§í¬ -->
    <a href="/index.html">ğŸ  í™ˆ</a>
    <a href="/write.html">âœï¸ ì‘ì„±</a>
  </div>
</nav>

<!-- âœ… ë³¸ë¬¸ ë‚´ìš© ì‹œì‘ -->
<main class="main-content">
  <h2>ğŸ“‹ ì¼ê¸° ëª©ë¡</h2>

  <!-- ğŸ”½ ì •ë ¬ ì˜µì…˜ ì„ íƒ -->
  <label for="sort">ì •ë ¬:</label>
  <select id="sort">
    <option value="desc">ìµœì‹ ìˆœ</option>
    <option value="asc">ì˜¤ë˜ëœìˆœ</option>
  </select>

  <!-- ğŸ“‹ ì¼ê¸°ë“¤ì´ ë“¤ì–´ê°ˆ ìë¦¬ -->
  <ul id="diary-list"></ul>
</main>

<!-- âœ… ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸° & ì‚­ì œ ë¡œì§ -->
<script>
  const diaryList = document.getElementById("diary-list");

  // ğŸ—‘ï¸ ì¼ê¸° ì‚­ì œ í•¨ìˆ˜
  async function deleteDiary(id) {
    await fetch(`/diaries/${id}`, { method: "DELETE" });
    loadDiaries(); // ì‚­ì œ í›„ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  }

  // ğŸ“¥ ì„œë²„ì—ì„œ ì¼ê¸°ë“¤ì„ ë°›ì•„ì™€ ëª©ë¡ì— ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
  async function loadDiaries() {
    const sort = document.getElementById("sort").value; // ì„ íƒëœ ì •ë ¬ ë°©ì‹
    const res = await fetch(`/diaries?sort=${sort}`);   // ì„œë²„ì— GET ìš”ì²­
    const data = await res.json();                      // JSONìœ¼ë¡œ ë³€í™˜

    diaryList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

    // ë°›ì•„ì˜¨ ì¼ê¸° ë°ì´í„°ë¥¼ í™”ë©´ì— ì¶”ê°€
    data.forEach((d) => {
      const li = document.createElement("li"); // ë¦¬ìŠ¤íŠ¸ í•­ëª© ìƒì„±
      li.innerHTML = `
        <strong>${d.title}</strong><br>
        ${d.content.replace(/\n/g, '<br>')} <!-- ì¤„ë°”ê¿ˆ ì²˜ë¦¬ -->
        <br><small>ğŸ•’ ${new Date(d.createdAt).toLocaleString()}</small>
        <button onclick="deleteDiary(${d.id})" style="margin-left: 10px;">ğŸ—‘ï¸ ì‚­ì œ</button>
      `;
      diaryList.appendChild(li); // ëª©ë¡ì— ì¶”ê°€
    });
  }

  loadDiaries(); // ğŸ”„ í˜ì´ì§€ ë¡œë“œ ì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°

  // ğŸ” ì •ë ¬ ì˜µì…˜ì´ ë³€ê²½ë˜ë©´ ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
  document.getElementById("sort").addEventListener("change", loadDiaries);
</script>

</body>
</html>
