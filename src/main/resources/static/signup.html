<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“ íšŒì›ê°€ì…</title>

    <!-- ìŠ¤íƒ€ì¼ ì‹œíŠ¸ / ì›¹í°íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <style>
        /* ğŸ‘‰ ì…ë ¥ ë¼ë²¨ + ì…ë ¥ì°½ í•œ ì¤„ì— ì •ë ¬ */
        .form-group {
          display: flex;
          align-items: center;
          margin-bottom: 12px;
        }

        /* ğŸ‘‰ ì™¼ìª½ ë¼ë²¨ ë„ˆë¹„ ê³ ì • */
        .form-group label {
          width: 130px;
          font-weight: bold;
        }

        /* ğŸ‘‰ ì˜¤ë¥¸ìª½ ì…ë ¥ì°½ (input, select) */
        .form-group input,
        .form-group select {
          flex: 1;
          padding: 6px;
        }

        /* ğŸ” íŒíŠ¸ ì„¤ëª… í…ìŠ¤íŠ¸ */
        .form-note {
          font-size: 0.9em;
          color: #777;
          margin: -10px 0 6px 130px;
        }

        /* âœ” ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜/ë¶ˆì¼ì¹˜ ë©”ì‹œì§€ */
        #passwordMatchMsg {
          margin-left: 10px;
          font-weight: bold;
        }
    </style>
</head>

<body>

<!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="nav-bar">
    <h1 class="nav-title">ğŸ“˜ ë‚˜ì˜ ì¼ê¸°ì¥</h1>
</nav>

<!-- ë³¸ë¬¸ ë‚´ìš© -->
<main class="main-content" style="max-width: 600px">
    <h2>ğŸ“ íšŒì›ê°€ì…</h2>

    <!-- íšŒì›ê°€ì… í¼ -->
    <form id="signupForm">
        <div class="form-group">
            <label for="name">ì´ë¦„</label>
            <input name="name" id="name" required>
        </div>

        <div class="form-group">
            <label for="birth">ìƒë…„ì›”ì¼</label>
            <input name="birth" id="birth" type="date" required>
        </div>

        <div class="form-group">
            <label for="gender">ì„±ë³„</label>
            <select name="gender" id="gender" required>
                <option value="">ì„ íƒ</option>
                <option value="male">ë‚¨ì</option>
                <option value="female">ì—¬ì</option>
                <option value="other">ê¸°íƒ€</option>
            </select>
        </div>

        <div class="form-group">
            <label for="email">ì´ë©”ì¼</label>
            <input name="email" id="email" type="email" required>
        </div>

        <div class="form-group">
            <label for="phone">ì—°ë½ì²˜</label>
            <input name="phone" id="phone" type="tel" required>
        </div>

        <div class="form-group">
            <label for="username">ì•„ì´ë””</label>
            <input name="username" id="username" required minlength="4">
        </div>

        <div class="form-group">
            <label for="password">ë¹„ë°€ë²ˆí˜¸</label>
            <input name="password" id="password" type="password" required minlength="6">
        </div>

        <div class="form-note">ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”</div>

        <div class="form-group">
            <label for="confirmPassword">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
            <input name="confirmPassword" id="confirmPassword" type="password" required>
            <span id="passwordMatchMsg"></span>
        </div>

        <button>íšŒì›ê°€ì…</button>
    </form>

    <!-- â— ì˜¤ë¥˜ ë©”ì‹œì§€ -->
    <p id="msg" style="color:red; margin-top: 10px;"></p>

    <!-- ë¡œê·¸ì¸ ë§í¬ -->
    <p style="margin-top: 20px;">
        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?
        <a href="/login.html">ë¡œê·¸ì¸í•˜ëŸ¬ ê°€ê¸° â†’</a>
    </p>
</main>

<script>
    const password = document.getElementById("password");
    const confirm = document.getElementById("confirmPassword");
    const matchMsg = document.getElementById("passwordMatchMsg");

    // âœ… ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ê°’ì´ ì¼ì¹˜í•˜ëŠ”ì§€ ì‹¤ì‹œê°„ ì²´í¬
    confirm.addEventListener("input", () =>
    {
      if (confirm.value === "")
      {
        matchMsg.textContent = "";
      } else if (password.value === confirm.value)
      {
        matchMsg.textContent = "âœ” ì¼ì¹˜!";
        matchMsg.style.color = "green";
      } else
      {
        matchMsg.textContent = "âŒ ë¶ˆì¼ì¹˜";
        matchMsg.style.color = "red";
      }
    });

    // âœ… íšŒì›ê°€ì… ìš”ì²­ ë³´ë‚´ê¸°
    document.getElementById('signupForm').onsubmit = async e =>
    {
      e.preventDefault(); // ê¸°ë³¸ í¼ ë™ì‘ ë§‰ê¸°

      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      // âŒ ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜
      if (data.password !== data.confirmPassword)
      {
        document.getElementById("msg").textContent = "âŒ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
        return;
      }

      // âœ… ì„œë²„ì— íšŒì›ê°€ì… ìš”ì²­ ë³´ë‚´ê¸°
      const res = await fetch('/users/signup',
      {
        method: 'POST',
        headers:
        {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      });

      if (res.ok)
      {
        alert("íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.");
        location.href = '/login.html';
      } else
      {
        document.getElementById("msg").textContent = await res.text();
      }
    };
</script>

</body>
</html>
