<!DOCTYPE html> <!-- 이 문서가 HTML5라는 걸 선언 -->
<html lang="en"> <!-- 문서의 언어는 영어 -->

<head>
    <meta charset="UTF-8"> <!-- 문자 인코딩 설정 (한글 등 여러 문자 가능) -->
    <title>나의 일기장</title> <!-- 브라우저 탭에 보일 제목 -->
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
</head>

<body>

<!-- 웹페이지 제목 -->
<h1>📘 나의 일기장 </h1>

<!-- ✍️ 일기를 작성하는 부분 (입력 폼) -->
<form id="diary-form">
    <!-- 제목 입력란 -->
    <input type="text" id="title" placeholder="제목" required />
    <br />

    <!-- 내용 입력란 (여러 줄 가능) -->
    <textarea id="content" placeholder="내용" required></textarea>
    <br />

    <!-- 저장 버튼 (눌렀을 때 서버로 데이터 전송됨) -->
    <button type="submit">일기 저장</button>
</form>

<!-- 📋 일기 목록을 보여주는 제목 -->
<h2>📜 일기 목록</h2>

<!-- 일기 목록이 여기에 하나씩 들어감 -->
<ul id="diary-list"></ul>

<!-- 🧠 자바스크립트: 웹페이지가 동작하는 로직 -->
<script>
    // 📌 입력 폼과 입력창들, 목록 영역을 변수로 저장
    const form = document.getElementById("diary-form");
    const titleInput = document.getElementById("title");
    const contentInput = document.getElementById("content");
    const diaryList = document.getElementById("diary-list");

    // [1] ✨ 일기 저장할 때 실행되는 코드
    form.addEventListener("submit", async (e) => {
        e.preventDefault(); // 기본 동작(새로고침) 막기

        // 입력한 제목과 내용을 객체로 만들기
        const diary = {
            title: titleInput.value,
            content: contentInput.value
        };

        // 서버에 POST 방식으로 보내기
        const res = await fetch("/diaries", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(diary)
        });

        // 성공적으로 저장되면 폼 초기화하고 다시 목록 불러오기
        if (res.ok) {
            titleInput.value = "";
            contentInput.value = "";
            loadDiaries();
        }
    });

    // [2] 🗑️ 삭제 요청을 보내는 함수
    async function deleteDiary(id) {
        await fetch(`/diaries/${id}`, {
            method: "DELETE"
        });
        loadDiaries(); // 삭제한 뒤 목록 새로고침
    }

    // [3] 📋 일기 목록을 서버에서 받아와서 화면에 보여주는 함수
    async function loadDiaries() {
        const res = await fetch("/diaries"); // 서버에 GET 요청
        const data = await res.json(); // 응답을 JSON 데이터로 변환

        // 기존 목록 비우기
        diaryList.innerHTML = "";

        // 받아온 일기 하나하나를 화면에 추가
        data.forEach((d) => {
            const li = document.createElement("li"); // 리스트 항목 만들기

            // 제목, 내용, 삭제 버튼을 함께 보여주기
            li.innerHTML = `
                <strong>${d.title}</strong><br>
                ${d.content.replace(/\n/g, '<br>')}
                <button onclick="deleteDiary(${d.id})" style="margin-left: 10px;">🗑️ 삭제</button>
            `;

            diaryList.appendChild(li); // 목록에 항목 추가
        });
    }

    // [4] 🔄 웹페이지 열리면 자동으로 일기 목록을 불러옴
    loadDiaries();
</script>

</body>
</html>
