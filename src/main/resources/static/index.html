<!DOCTYPE html> <!-- HTML5 ë¬¸ì„œì„ì„ ì„ ì–¸ -->
<html lang="en"> <!-- HTML ë¬¸ì„œ ì–¸ì–´ëŠ” ì˜ì–´ -->

<head>
    <meta charset="UTF-8"> <!-- ë¬¸ì ì¸ì½”ë”©: í•œê¸€ í¬í•¨í•œ ë‹¤ì–‘í•œ ë¬¸ì ì§€ì› -->
    <title>ë‚˜ì˜ ì¼ê¸°ì¥</title> <!-- ë¸Œë¼ìš°ì € íƒ­ì— í‘œì‹œë  ì œëª© -->
</head>

<body>
<h1>ğŸ“˜ ë‚˜ì˜ ì¼ê¸°ì¥ </h1> <!-- ê°€ì¥ í° ì œëª© -->

<!-- ì¼ê¸° ì‘ì„± í¼ -->
<form id="diary-form">
    <input type="text" id="title" placeholder="ì œëª©" required />
    <!-- ì œëª© ì…ë ¥ì°½, ë¹„ì–´ ìˆìœ¼ë©´ ì œì¶œ ë¶ˆê°€ -->

    <br />

    <textarea id="content" placeholder="ë‚´ìš©" required></textarea>
    <!-- ë‚´ìš© ì…ë ¥ì°½, ì—¬ëŸ¬ ì¤„ ì…ë ¥ ê°€ëŠ¥ -->

    <br />

    <button type="submit">ì¼ê¸° ì €ì¥</button>
    <!-- ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¼ê¸° ì €ì¥ë¨ -->
</form>

<h2>ğŸ“œ ì¼ê¸° ëª©ë¡</h2> <!-- ì¼ê¸° ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì¤„ ì œëª© -->
<ul id="diary-list"></ul> <!-- ì—¬ê¸°ì— ì¼ê¸° í•­ëª©ë“¤ì´ ì¶”ê°€ë  ì˜ˆì • -->

<!-- ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œ ì‹œì‘ -->
<script>
    // DOM ìš”ì†Œë“¤ ê°€ì ¸ì˜¤ê¸°
    const form = document.getElementById("diary-form"); // í¼
    const titleInput = document.getElementById("title"); // ì œëª© ì…ë ¥ë€
    const contentInput = document.getElementById("content"); // ë‚´ìš© ì…ë ¥ë€
    const diaryList = document.getElementById("diary-list"); // ì¼ê¸° ëª©ë¡ <ul>

    // [1] ì¼ê¸° ì €ì¥ ì²˜ë¦¬
    form.addEventListener("submit", async (e) => {
        e.preventDefault(); // í¼ ê¸°ë³¸ ë™ì‘(í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨) ë§‰ê¸°

        // ì…ë ¥í•œ ì œëª©ê³¼ ë‚´ìš©ì„ ê°ì²´ë¡œ ë§Œë“¦
        const diary = {
            title: titleInput.value,
            content: contentInput.value
        };

        // POST ìš”ì²­ìœ¼ë¡œ ì„œë²„ì— ì¼ê¸° ì „ì†¡
        const res = await fetch("/diaries", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(diary) // ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜
        });

        // ì „ì†¡ ì„±ê³µ ì‹œ ì…ë ¥ì¹¸ ì´ˆê¸°í™” + ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        if (res.ok) {
            titleInput.value = "";
            contentInput.value = "";
            loadDiaries(); // ìµœì‹  ì¼ê¸° ëª©ë¡ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê¸°
        }
    });

    // [2] ì¼ê¸° ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadDiaries() {
        const res = await fetch("/diaries"); // ì„œë²„ì— GET ìš”ì²­
        const data = await res.json(); // ì‘ë‹µì„ JSONìœ¼ë¡œ ë³€í™˜

        diaryList.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        // ì¼ê¸° í•˜ë‚˜í•˜ë‚˜ <li> íƒœê·¸ë¡œ ì¶”ê°€
        data.forEach((d) => {
            const li = document.createElement("li");
            li.innerHTML = `ğŸ“– <strong>${d.title}</strong><br>${d.content.replace(/\n/g, '<br>')}`; // ì œëª©ê³¼ ë‚´ìš© í‘œì‹œ
            diaryList.appendChild(li); // <ul>ì— <li> ì¶”ê°€
        });
    }

    // [3] í˜ì´ì§€ ì²˜ìŒ ì—´ë¦´ ë•Œ ìë™ìœ¼ë¡œ ì¼ê¸° ë¶ˆëŸ¬ì˜¤ê¸°
    loadDiaries();
</script>
</body>
</html>