<!DOCTYPE html> <!-- ì´ ë¬¸ì„œê°€ HTML5ë¼ëŠ” ê±¸ ì„ ì–¸ -->
<html lang="en"> <!-- ë¬¸ì„œì˜ ì–¸ì–´ëŠ” ì˜ì–´ -->

<head>
    <meta charset="UTF-8"> <!-- ë¬¸ì ì¸ì½”ë”© ì„¤ì • (í•œê¸€ ë“± ì—¬ëŸ¬ ë¬¸ì ê°€ëŠ¥) -->
    <title>ë‚˜ì˜ ì¼ê¸°ì¥</title> <!-- ë¸Œë¼ìš°ì € íƒ­ì— ë³´ì¼ ì œëª© -->
    <link rel="stylesheet" href="/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">
</head>

<body>

<!-- ì›¹í˜ì´ì§€ ì œëª© -->
<h1>ğŸ“˜ ë‚˜ì˜ ì¼ê¸°ì¥ </h1>

<!-- âœï¸ ì¼ê¸°ë¥¼ ì‘ì„±í•˜ëŠ” ë¶€ë¶„ (ì…ë ¥ í¼) -->
<form id="diary-form">
    <!-- ì œëª© ì…ë ¥ë€ -->
    <input type="text" id="title" placeholder="ì œëª©" required />
    <br />

    <!-- ë‚´ìš© ì…ë ¥ë€ (ì—¬ëŸ¬ ì¤„ ê°€ëŠ¥) -->
    <textarea id="content" placeholder="ë‚´ìš©" required></textarea>
    <br />

    <!-- ì €ì¥ ë²„íŠ¼ (ëˆŒë €ì„ ë•Œ ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ë¨) -->
    <button type="submit">ì¼ê¸° ì €ì¥</button>
</form>

<!-- ğŸ“‹ ì¼ê¸° ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ì œëª© -->
<h2>ğŸ“œ ì¼ê¸° ëª©ë¡</h2>

<!-- ì¼ê¸° ëª©ë¡ì´ ì—¬ê¸°ì— í•˜ë‚˜ì”© ë“¤ì–´ê° -->
<ul id="diary-list"></ul>

<!-- ğŸ§  ìë°”ìŠ¤í¬ë¦½íŠ¸: ì›¹í˜ì´ì§€ê°€ ë™ì‘í•˜ëŠ” ë¡œì§ -->
<script>
    // ğŸ“Œ ì…ë ¥ í¼ê³¼ ì…ë ¥ì°½ë“¤, ëª©ë¡ ì˜ì—­ì„ ë³€ìˆ˜ë¡œ ì €ì¥
    const form = document.getElementById("diary-form");
    const titleInput = document.getElementById("title");
    const contentInput = document.getElementById("content");
    const diaryList = document.getElementById("diary-list");

    // [1] âœ¨ ì¼ê¸° ì €ì¥í•  ë•Œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œ
    form.addEventListener("submit", async (e) => {
        e.preventDefault(); // ê¸°ë³¸ ë™ì‘(ìƒˆë¡œê³ ì¹¨) ë§‰ê¸°

        // ì…ë ¥í•œ ì œëª©ê³¼ ë‚´ìš©ì„ ê°ì²´ë¡œ ë§Œë“¤ê¸°
        const diary = {
            title: titleInput.value,
            content: contentInput.value
        };

        // ì„œë²„ì— POST ë°©ì‹ìœ¼ë¡œ ë³´ë‚´ê¸°
        const res = await fetch("/diaries", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(diary)
        });

        // ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ë©´ í¼ ì´ˆê¸°í™”í•˜ê³  ë‹¤ì‹œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
        if (res.ok) {
            titleInput.value = "";
            contentInput.value = "";
            loadDiaries();
        }
    });

    // [2] ğŸ—‘ï¸ ì‚­ì œ ìš”ì²­ì„ ë³´ë‚´ëŠ” í•¨ìˆ˜
    async function deleteDiary(id) {
        await fetch(`/diaries/${id}`, {
            method: "DELETE"
        });
        loadDiaries(); // ì‚­ì œí•œ ë’¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    }

    // [3] ğŸ“‹ ì¼ê¸° ëª©ë¡ì„ ì„œë²„ì—ì„œ ë°›ì•„ì™€ì„œ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” í•¨ìˆ˜
    async function loadDiaries() {
        const res = await fetch("/diaries"); // ì„œë²„ì— GET ìš”ì²­
        const data = await res.json(); // ì‘ë‹µì„ JSON ë°ì´í„°ë¡œ ë³€í™˜

        // ê¸°ì¡´ ëª©ë¡ ë¹„ìš°ê¸°
        diaryList.innerHTML = "";

        // ë°›ì•„ì˜¨ ì¼ê¸° í•˜ë‚˜í•˜ë‚˜ë¥¼ í™”ë©´ì— ì¶”ê°€
        data.forEach((d) => {
            const li = document.createElement("li"); // ë¦¬ìŠ¤íŠ¸ í•­ëª© ë§Œë“¤ê¸°

            // ì œëª©, ë‚´ìš©, ì‚­ì œ ë²„íŠ¼ì„ í•¨ê»˜ ë³´ì—¬ì£¼ê¸°
            li.innerHTML = `
                <strong>${d.title}</strong><br>
                ${d.content.replace(/\n/g, '<br>')}
                <button onclick="deleteDiary(${d.id})" style="margin-left: 10px;">ğŸ—‘ï¸ ì‚­ì œ</button>
            `;

            diaryList.appendChild(li); // ëª©ë¡ì— í•­ëª© ì¶”ê°€
        });
    }

    // [4] ğŸ”„ ì›¹í˜ì´ì§€ ì—´ë¦¬ë©´ ìë™ìœ¼ë¡œ ì¼ê¸° ëª©ë¡ì„ ë¶ˆëŸ¬ì˜´
    loadDiaries();
</script>

</body>
</html>
